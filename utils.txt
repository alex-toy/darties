git rm -r --cached .
git add .
git commit -m ".gitignore is now working"
git push


python3 -m venv .venv
source .venv/bin/activate
deactivate


python -m pip install -r requirements.txt


docker pull puckel/docker-airflow

# from cli :
docker run -d -p 8080:8080 -v /Users/alexei/docs/MIAGE/S4/D605/darties/airflow:/usr/local/airflow puckel/docker-airflow webserver
#inside docker container, run :
docker exec -u root -it <container_id> bash
pip install xlrd>=1.0.0
pip install openpyxl
pip install requests
pip install beautifulsoup4
pip install lxml

# from Dockerfile :
docker build -t webserver .
docker run -d --rm -p 8080:8080 -v /Users/alexei/docs/MIAGE/S4/D605/darties/airflow:/usr/local/airflow --name airflowserver webserver

airflow will run at : http://localhost:8080
docker exec -it airflowserver bash
docker stop airflowserver

curl -X "DELETE" http://127.0.0.1:8080/api/experimental/dags/test_dag


AIRFLOW CONNECTIONS :

    AWS :
        Conn Id : aws_credentials
        Conn Type : Amazon Web Services
        Login : Access key ID from the S3_USER User credentials
        Password : Secret access key from the S3_USER User credentials

    REDSHIFT :
        Conn Id : redshift
        Conn Type : Postgres
        Host : endpoint of your Redshift cluster, excluding the port at the end
        Schema :  dev
        Login : awsuser
        Password :  password you created when launching your Redshift cluster.
        Port : 5439



### SQL de vérification :

## Dans le modèle étoile 
SELECT famille_produit.lib_famille_produit, temps.lib_mois, temps.annee, ville.lib_ville, sales.vente_objectif
FROM sales 
JOIN temps ON temps.id_temps = sales.id_temps
JOIN ville ON sales.id_ville = ville.id_ville
JOIN famille_produit ON famille_produit.id_famille_produit = sales.id_famille_produit

WHERE famille_produit.lib_famille_produit = 'hifi' AND temps.annee = 2020 AND temps.lib_mois = 'avril'

limit 10;


## Dans les staging :
SELECT o_avril
FROM staging_v_hifi 
WHERE annee = 2020  AND villes = 'strasbourg'
LIMIT 10;
